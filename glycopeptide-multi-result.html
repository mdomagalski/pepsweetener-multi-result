<!-- Imports polymer -->
<link rel="import" href="../paper-menu/paper-menu.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-spinner/paper-spinner.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../glycopeptide-heatmap/glycopeptide-heatmap.html">


<!-- Defines element markup -->
<dom-module id="glycopeptide-multi-result">

    <template>
        <style>
            :root {
                display: flex;
                --paper-card: {
                    flex: 1;
                    width: 85%;
                };
                --paper-menu: {
                    min-width: 200px;
                    width: 14%;
                    float: left;
                    padding-left: 1.5rem;
                    padding-right: 1.5rem;
                    margin-top: 10px;
                };

            }

            paper-item {
                white-space: nowrap;
            }

            paper-fab {
                margin-right: 12px;
            }

            paper-fab.green {
                --paper-fab-background: var(--paper-green-500);
                --paper-fab-keyboard-focus-background: var(--paper-green-900);
            }

            paper-fab.red {
                --paper-fab-background: var(--paper-red-500);
                --paper-fab-keyboard-focus-background: var(--paper-red-900);
            }

            paper-fab[disabled]{
                display: none;
            }

            paper-item.iron-selected {
                border-left: thick solid #ff0000;
                font-size: 150%;
            }

            glycopeptide-heatmap {
                display: inline-block;
            }
        </style>
    <paper-menu id="resultsMenu" selected="{{selected}}" attr-for-selected="value">
        <template id="menu" is="dom-repeat" items="{{masses}}">
            <paper-item id="tab{{index}}" value="{{item}}" role="menuItem">
                <paper-spinner id="spinner{{index}}" alt="Loading {{item}}" active></paper-spinner>
                <paper-fab mini icon="done" id="success{{index}}" class="green" active></paper-fab>
                <paper-fab mini icon="clear" id="fail{{index}}" class="red" active></paper-fab>
                {{item}}
                <iron-icon icon="chevron-right" active></iron-icon>
            </paper-item>
        </template>
    </paper-menu>
    <paper-card elevation="0">
        <div class="card-content">
            <glycopeptide-heatmap id="heatmap" data={{datasets.selected}}>
            </glycopeptide-heatmap>
        </div>
    </paper-card>
    </template>

    <!-- Registers custom element -->
    <script>
    Polymer({
        is: 'glycopeptide-multi-result',

        properties:{
            masses: {
                type: Array,
                observer: '_renderMenu'
            },
            datasets: {
                type: Object,
                value: {}
            },
            selected: {
                type: Number,
                observer: '_datasetSelected'
            }
        },
        _renderMenu: function () {
            this.$.menu.render();
        },
        newDataset: function (d){
            this.datasets[d.mass] = d.data;
            this.$$('#spinner'+this.masses.indexOf(d.mass)).setAttribute('class', 'hidden');
            if(this.datasets[d.mass]['map'].length>0){
                this.$$('#success'+this.masses.indexOf(d.mass)).disabled = false;
                this.$$('#fail'+this.masses.indexOf(d.mass)).disabled = true;
            }else{
                this.$$('#fail'+this.masses.indexOf(d.mass)).disabled = false;
                this.$$('#success'+this.masses.indexOf(d.mass)).disabled = true;
            }
            this.selected = this.masses.indexOf(d.mass);
        },
        _datasetSelected: function(newValue) {
            var  chart = this.$.heatmap;
            chart.data = this.datasets[newValue];
        }
    });
    </script>
</dom-module>
